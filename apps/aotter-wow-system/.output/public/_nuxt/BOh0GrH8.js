import{_ as C}from"./BiOihQpM.js";import{e as N,r as p,f as V,s as S,l as T,g as D,c as i,a as t,b as y,w as b,i as v,h as M,j as f,v as _,u as o,t as l,y as z,F as B,p as L,d as x,o as d,k as j}from"./C5HONyTf.js";import{u as q}from"./Bqc3Q5j0.js";const A={class:"min-h-screen bg-gray-50"},F={class:"bg-white shadow-sm border-b"},U={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},W={class:"flex justify-between items-center h-16"},H={class:"flex items-center"},$={class:"flex items-center space-x-4"},E={class:"max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8"},O={class:"wow-card"},P={class:"mt-1 text-sm text-gray-500"},G=["value"],J={class:"mt-1 text-sm text-gray-500"},K={key:0,class:"bg-red-50 border border-red-200 rounded-md p-3"},Q={class:"text-sm text-red-600"},R={key:1,class:"bg-green-50 border border-green-200 rounded-md p-3"},X={class:"text-sm text-green-600"},Y={class:"flex items-center justify-between"},Z={class:"space-x-4"},tt=["disabled"],et={key:0,class:"inline-flex items-center"},st={key:1},ot={key:0,class:"wow-card mt-8"},at={class:"border border-gray-200 rounded-lg p-4"},nt={class:"text-lg font-semibold text-gray-900 mb-2"},rt={class:"text-gray-600 mb-3 whitespace-pre-wrap"},lt={class:"flex items-center space-x-4 text-sm text-gray-500"},mt=N({__name:"create",setup(it){q({title:"Aotter Wow - 發表貼文"});const u=p(!1),a=p(""),c=p(""),g=p([]),s=V({title:"",content:"",categoryId:""}),w=S(()=>{if(!s.categoryId)return"";const n=g.value.find(e=>e.id===Number(s.categoryId));return(n==null?void 0:n.name)||""}),h=async()=>{try{const{data:n}=await $fetch("/api/categories");g.value=n||[]}catch(n){console.error("Load categories error:",n),a.value="載入類別失敗"}},k=()=>{s.title="",s.content="",s.categoryId="",a.value="",c.value=""},I=async()=>{var n;u.value=!0,a.value="",c.value="";try{if(!s.title.trim()){a.value="請輸入標題";return}if(!s.content.trim()){a.value="請輸入內容";return}if(!s.categoryId){a.value="請選擇類別";return}const e={title:s.title.trim(),content:s.content.trim(),categoryId:Number(s.categoryId)},{data:m}=await $fetch("/api/posts",{method:"POST",body:e});c.value="貼文發表成功！",setTimeout(()=>{j("/")},1500)}catch(e){console.error("Submit post error:",e),a.value=((n=e.data)==null?void 0:n.message)||e.message||"發表失敗，請稍後再試"}finally{u.value=!1}};return T(()=>{h()}),D([()=>s.title,()=>s.content,()=>s.categoryId],()=>{a.value&&(a.value="")}),(n,e)=>{const m=C;return d(),i("div",A,[t("nav",F,[t("div",U,[t("div",W,[t("div",H,[y(m,{to:"/",class:"text-2xl font-bold text-gray-900"},{default:b(()=>e[3]||(e[3]=[x(" Aotter "),t("span",{class:"text-purple-600"},"Wow",-1)])),_:1,__:[3]})]),t("div",$,[y(m,{to:"/",class:"text-gray-600 hover:text-purple-600"},{default:b(()=>e[4]||(e[4]=[x(" 回到首頁 ")])),_:1,__:[4]})])])])]),t("main",E,[t("div",O,[e[11]||(e[11]=t("h1",{class:"text-3xl font-bold text-gray-900 mb-8"},"發表新貼文",-1)),t("form",{onSubmit:M(I,["prevent"]),class:"space-y-6"},[t("div",null,[e[5]||(e[5]=t("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-2"}," 標題 * ",-1)),f(t("input",{id:"title","onUpdate:modelValue":e[0]||(e[0]=r=>o(s).title=r),type:"text",required:"",maxlength:"200",class:"wow-input",placeholder:"請輸入貼文標題"},null,512),[[_,o(s).title]]),t("p",P,l(o(s).title.length)+"/200 字元",1)]),t("div",null,[e[7]||(e[7]=t("label",{for:"category",class:"block text-sm font-medium text-gray-700 mb-2"}," 類別 * ",-1)),f(t("select",{id:"category","onUpdate:modelValue":e[1]||(e[1]=r=>o(s).categoryId=r),required:"",class:"wow-input"},[e[6]||(e[6]=t("option",{value:""},"請選擇類別",-1)),(d(!0),i(B,null,L(o(g),r=>(d(),i("option",{key:r.id,value:r.id},l(r.name),9,G))),128))],512),[[z,o(s).categoryId]])]),t("div",null,[e[8]||(e[8]=t("label",{for:"content",class:"block text-sm font-medium text-gray-700 mb-2"}," 內容 * ",-1)),f(t("textarea",{id:"content","onUpdate:modelValue":e[2]||(e[2]=r=>o(s).content=r),required:"",rows:"8",maxlength:"5000",class:"wow-input resize-none",placeholder:"分享你的美好體驗..."},null,512),[[_,o(s).content]]),t("p",J,l(o(s).content.length)+"/5000 字元",1)]),o(a)?(d(),i("div",K,[t("p",Q,l(o(a)),1)])):v("",!0),o(c)?(d(),i("div",R,[t("p",X,l(o(c)),1)])):v("",!0),t("div",Y,[t("button",{type:"button",onClick:k,class:"bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg transition-colors"}," 清空內容 "),t("div",Z,[y(m,{to:"/",class:"bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg transition-colors"},{default:b(()=>e[9]||(e[9]=[x(" 取消 ")])),_:1,__:[9]}),t("button",{type:"submit",disabled:o(u),class:"wow-button disabled:opacity-50 disabled:cursor-not-allowed"},[o(u)?(d(),i("span",et,e[10]||(e[10]=[t("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),x(" 發表中... ")]))):(d(),i("span",st,"發表貼文"))],8,tt)])])],32)]),o(s).title||o(s).content?(d(),i("div",ot,[e[13]||(e[13]=t("h2",{class:"text-xl font-bold text-gray-900 mb-4"},"預覽",-1)),t("div",at,[t("h3",nt,l(o(s).title||"標題預覽"),1),t("p",rt,l(o(s).content||"內容預覽"),1),t("div",lt,[e[12]||(e[12]=t("span",null,"您的名稱",-1)),t("span",null,l(o(w)||"未選擇類別"),1),t("span",null,l(new Date().toLocaleDateString("zh-TW")),1)])])])):v("",!0)])])}}});export{mt as default};
